---
kind: AnimusExtensionTemplate
version: v1
metadata:
  name: aws_boto3_cloud_formation_template-v1
  skipDeleteAll: false # FIXME deletre when done
  executeOnlyOnceOnApply: true
  executeOnlyOnceOnDelete: true
spec:
  description: |
    Defines a group of tags that can be linked to one or more CloudFormation templates.

    The data will be stored in the following Variable objects:

    * `TAG_KEYS` - A list of keys
    * `TAGS` - A dictionary in the format { "<<tag_key>>": "<<tag_value>>" }. All tag_value values will be strings
  kind: AwsBoto3CloudFormationTemplate
  version: v1
  versionChangelog: |
    This is the initial version
  supportedVersions:
  - 'v1'
  baseClass: ManifestBase
  outputPaths:
    doc: /tmp/aws_boto3_cloud_formation_template-v1/doc
    examples: /tmp/aws_boto3_cloud_formation_template-v1/examples
    implementations: /tmp/aws_boto3_cloud_formation_template-v1/impl
  pipRequirements:
  - 'py-animus'
  importStatements:
  - 'from py_animus.manifest_management import *'
  - 'from py_animus import get_logger, get_utc_timestamp'
  specFields:
  - fieldName: awsBoto3SessionReference
    fieldDescription: |
      The AWS credentials to use for this template. The value is the "name" of the relevant "AwsBoto3Session" manifest to use
    fieldType: string
    fieldRequired: true
    fieldDefaultValue: None
    fieldSetDefaultValueConditions:
    - fieldDefinitionNotPresentInManifest: true
    - fieldValueTypeMismatch: true
    - fieldValueIsNull: true
    customValidation: |
      self.log(message='No custom validation for promptText', level='debug')
  - fieldName: tagReferences
    fieldDescription: |
      Reference to the names of a "AwsBoto3CloudFormationTemplateTags" manifests. All tags from these references will be added to the CloudFormation template
    fieldType: list
    fieldRequired: false
    fieldDefaultValue: []
    fieldSetDefaultValueConditions:
    - fieldDefinitionNotPresentInManifest: true
    - fieldValueTypeMismatch: true
    - fieldValueIsNull: true
    customValidation: |
      self.log(message='No custom validation for promptText', level='debug')
  - fieldName: parameterReferences
    fieldDescription: |
      Reference to the names of  "AwsBoto3CloudFormationTemplateParameters" manifests. All parameters from these references will be added to the CloudFormation template
    fieldType: list
    fieldRequired: false
    fieldDefaultValue: []
    fieldSetDefaultValueConditions:
    - fieldDefinitionNotPresentInManifest: true
    - fieldValueTypeMismatch: true
    - fieldValueIsNull: true
    customValidation: |
      self.log(message='No custom validation for promptText', level='debug')
  - fieldName: templatePath
    fieldDescription: |
      Path to the CloudFormation file. The file must be on the local filesystem. If the file is in a Git repository,
      first use "GitRepo" to get the files onto the local system (as an example)
    fieldType: string
    fieldRequired: true
    fieldDefaultValue: null
    fieldSetDefaultValueConditions:
    - fieldDefinitionNotPresentInManifest: true
    - fieldValueTypeMismatch: true
    - fieldValueIsNull: true
    customValidation: |
      self.log(message='No custom validation for promptText', level='debug')
  - fieldName: options.disableRollback
    fieldDescription: 'Maps to "DisableRollback" option in the AWS API'
    fieldType: boolean
    fieldRequired: false
    fieldDefaultValue: false
    fieldSetDefaultValueConditions:
    - fieldDefinitionNotPresentInManifest: true
    - fieldValueTypeMismatch: true
    - fieldValueIsNull: true
    customValidation: |
      self.log(message='No custom validation for promptText', level='debug')
  - fieldName: options.timeoutInMinutes
    fieldDescription: 'Maps to "TimeoutInMinutes" option in the AWS API'
    fieldType: integer
    fieldRequired: false
    fieldDefaultValue: 600
    fieldSetDefaultValueConditions:
    - fieldDefinitionNotPresentInManifest: true
    - fieldValueTypeMismatch: true
    - fieldValueIsNull: true
    customValidation: |
      self.log(message='No custom validation for promptText', level='debug')
  - fieldName: options.notificationARNs
    fieldDescription: 'Maps to "NotificationARNs" option in the AWS API'
    fieldType: list
    fieldRequired: false
    fieldDefaultValue: []
    fieldSetDefaultValueConditions:
    - fieldDefinitionNotPresentInManifest: true
    - fieldValueTypeMismatch: true
    - fieldValueIsNull: true
    customValidation: |
      self.log(message='No custom validation for promptText', level='debug')
  - fieldName: options.capabilities
    fieldDescription: |
      'Maps to "Capabilities" option in the AWS API. If supplied, can be "CAPABILITY_IAM" and/or "CAPABILITY_NAMED_IAM"
      and/or "CAPABILITY_AUTO_EXPAND"'
    fieldType: list
    fieldRequired: false
    fieldDefaultValue: []
    fieldSetDefaultValueConditions:
    - fieldDefinitionNotPresentInManifest: true
    - fieldValueTypeMismatch: true
    - fieldValueIsNull: true
    customValidation: |
      self.log(message='No custom validation for promptText', level='debug')
  - fieldName: options.onFailure
    fieldDescription: 'Default "ROLLBACK". If supplied, one of "DO_NOTHING" or "ROLLBACK" or "DELETE"'
    fieldType: string
    fieldRequired: false
    fieldDefaultValue: ROLLBACK
    fieldSetDefaultValueConditions:
    - fieldDefinitionNotPresentInManifest: true
    - fieldValueTypeMismatch: true
    - fieldValueIsNull: true
    customValidation: |
      self.log(message='No custom validation for promptText', level='debug')
  - fieldName: options.enableTerminationProtection
    fieldDescription: 'Maps to "EnableTerminationProtection" option in the AWS API'
    fieldType: boolean
    fieldRequired: false
    fieldDefaultValue: false
    fieldSetDefaultValueConditions:
    - fieldDefinitionNotPresentInManifest: true
    - fieldValueTypeMismatch: true
    - fieldValueIsNull: true
    customValidation: |
      self.log(message='No custom validation for promptText', level='debug')
  - fieldName: changeDetection.features.remoteTemplateValueEvaluation
    fieldDescription: |
      See https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/cloudformation/client/get_template.html
      - the remote template will be compared with the current one.
    fieldType: boolean
    fieldRequired: false
    fieldDefaultValue: true
    fieldSetDefaultValueConditions:
    - fieldDefinitionNotPresentInManifest: true
    - fieldValueTypeMismatch: true
    - fieldValueIsNull: true
    customValidation: |
      self.log(message='No custom validation for promptText', level='debug')
  - fieldName: changeDetection.features.alwaysCreateChangeset
    fieldDescription: |
      Regardless if changes are present or not, create a changeset. This makes other change evaluation more or less
      redundant.
    fieldType: boolean
    fieldRequired: false
    fieldDefaultValue: false
    fieldSetDefaultValueConditions:
    - fieldDefinitionNotPresentInManifest: true
    - fieldValueTypeMismatch: true
    - fieldValueIsNull: true
    customValidation: |
      self.log(message='No custom validation for promptText', level='debug')
  - fieldName: changeDetection.customEvaluations.variableEvaluations
    fieldDescription: |
      Based on the value of a prior set `Variable`, a change can be assumed. Each list item is an object with the
      following fields: <ul> <li>`variableName` (string) - The name of the "Variable".</li> <li>`expectedValue`
      (string) - The Python string representation of a variable value.</li> <li>`changeDetectedIfValueMatch`
      (boolean, default=true) - If the "expectedValue" is matched, assume changes were detected. If "False" and value
      OTHER than the "expectedValue" will indicate change was detected.</li> </ul>
    fieldType: list
    fieldRequired: false
    fieldDefaultValue: []
    fieldSetDefaultValueConditions:
    - fieldDefinitionNotPresentInManifest: true
    - fieldValueTypeMismatch: true
    - fieldValueIsNull: true
    customValidation: |
      self.log(message='No custom validation for promptText', level='debug')
  - fieldName: raiseExceptionOnFinalStatusValues
    fieldDescription: |
      Add one or more of the following status codes that will force an exception to be raised (causing further deployment processing to stop). Possible options:
      <ul>
        <li>`CREATE_FAILED` (included in default)</li>
        <li>`DELETE_FAILED` (included in default)</li>
        <li>`ROLLBACK_FAILED` (included in default)</li>
        <li>`UPDATE_FAILED` (included in default)</li>
        <li>`UPDATE_ROLLBACK_FAILED` (included in default)</li>
        <li>`IMPORT_ROLLBACK_FAILED` (included in default)</li>
        <li>`CREATE_COMPLETE`</li>
        <li>`DELETE_COMPLETE`</li>
        <li>`ROLLBACK_COMPLETE`</li>
        <li>`UPDATE_COMPLETE`</li>
        <li>`UPDATE_ROLLBACK_COMPLETE`</li>
        <li>`IMPORT_COMPLETE`</li>
        <li>`IMPORT_ROLLBACK_COMPLETE`</li>
      </ul>
      An empty list will ignore any status
    fieldType: list
    fieldRequired: false
    fieldDefaultValue: ["CREATE_FAILED", "DELETE_FAILED", "ROLLBACK_FAILED", "UPDATE_FAILED", "UPDATE_ROLLBACK_FAILED", "IMPORT_ROLLBACK_FAILED"]
    fieldSetDefaultValueConditions:
    - fieldDefinitionNotPresentInManifest: true
    - fieldValueTypeMismatch: true
    - fieldValueIsNull: true
    customValidation: |
      self.log(message='No custom validation for promptText', level='debug')